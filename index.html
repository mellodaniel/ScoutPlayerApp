<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/857/857681.png" type="image/png">
  <title>⚽ ScoutPlayerApp</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f2f2f2;
    }

    h1 {
      text-align: center;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    input[type="text"], select {
      padding: 10px;
      font-size: 1rem;
    }

    input[type="text"] {
      width: 100%;
      margin-bottom: 10px;
    }

    select {
      width: 100%;
      margin-bottom: 10px;
    }

    button {
      padding: 10px;
      font-size: 1rem;
      width: 100%;
    }

    .player {
      margin-top: 2rem;
    }

    .player img {
      width: 80px;
      border-radius: 50%;
    }

    .stats {
      margin-top: 1rem;
    }

    .stat {
      margin: 5px 0;
    }

    .loader {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #333;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ScoutPlayerApp</h1>
    <div>
      <input type="text" id="playerName" placeholder="Digite o nome do jogador">

      <select id="leagueSelect">
        <option value="2">🏆 Champions League</option>
        <option value="39">🏴 Premier League (Inglaterra)</option>
        <option value="40">🏴 Championship (Inglaterra)</option>
        <option value="41">🏴 League One (Inglaterra)</option>
        <option value="42">🏴 League Two (Inglaterra)</option>
        <option value="140">🇪🇸 La Liga</option>
        <option value="141">🇪🇸 La Liga 2</option>
        <option value="135">🇮🇹 Serie A</option>
        <option value="136">🇮🇹 Serie B</option>
        <option value="78">🇩🇪 Bundesliga</option>
        <option value="79">🇩🇪 2. Bundesliga</option>
        <option value="61">🇫🇷 Ligue 1</option>
        <option value="62">🇫🇷 Ligue 2</option>
        <option value="94">🇵🇹 Primeira Liga</option>
        <option value="95">🇵🇹 Segunda Liga</option>
        <option value="88">🇳🇱 Eredivisie</option>
        <option value="144">🇳🇱 Eerste Divisie</option>
        <option value="262">🇧🇪 Pro League</option>
        <option value="71">🇧🇷 Brasileirão Série A</option>
        <option value="72">🇧🇷 Brasileirão Série B</option>
        <option value="128">🇦🇷 Liga Profesional</option>
        <option value="129">🇦🇷 Primera B Nacional</option>
        <option value="235">🇺🇾 Primera División (Uruguai)</option>
        <option value="197">🇨🇱 Primera División (Chile)</option>
        <option value="194">🇨🇴 Primera A (Colômbia)</option>
        <option value="199">🇵🇾 Primera División (Paraguai)</option>
        <option value="203">🇵🇪 Liga 1 (Peru)</option>
        <option value="195">🇪🇨 Serie A (Equador)</option>
      </select>

      <select id="seasonStart"></select>
      <select id="seasonEnd"></select>

      <button onclick="buscarJogador()">Buscar</button>
    </div>

    <div id="spinner" style="display: none; text-align: center; margin-top: 20px;">
      <div class="loader"></div>
    </div>

    <div id="resultado" class="player"></div>

    <div id="ligaStats" style="margin-top: 40px;">
      <h2 style="text-align:center;">📊 Estatísticas da Liga: Top Scorers</h2>
      <div id="topScorers"></div>
    </div>
  </div>

  <script>
    const seasonStart = document.getElementById("seasonStart");
    const seasonEnd = document.getElementById("seasonEnd");
    for (let y = 2023; y >= 2000; y--) {
      seasonStart.innerHTML += `<option value="${y}">${y}</option>`;
      seasonEnd.innerHTML += `<option value="${y}">${y}</option>`;
    }
    seasonStart.value = "2000";
    seasonEnd.value = "2023";

    async function buscarJogador() {
      const nome = document.getElementById("playerName").value.trim();
      const start = parseInt(document.getElementById("seasonStart").value);
      const end = parseInt(document.getElementById("seasonEnd").value);
      const league = document.getElementById("leagueSelect").value;
      const spinner = document.getElementById("spinner");
      const resultado = document.getElementById("resultado");

      if (!nome || start > end) return alert("Verifique o nome e o intervalo de épocas.");

      spinner.style.display = "block";
      resultado.innerHTML = "";

      const apiKey = "ce4cbe1f65f7af21897ba33e58fd9372";
      let found = false;

      for (let ano = end; ano >= start; ano--) {
        const url = `https://v3.football.api-sports.io/players?search=${encodeURIComponent(nome)}&season=${ano}&league=${league}`;
        try {
          const resposta = await fetch(url, {
            headers: { "x-apisports-key": apiKey }
          });

          const data = await resposta.json();
          if (data.response && data.response.length > 0) {
            spinner.style.display = "none";
            const jogador = data.response[0].player;
            const stats = data.response[0].statistics[0];

            resultado.innerHTML = `
              <div>
                <img src="${jogador.photo}" alt="${jogador.name}">
                <h2>${jogador.name}</h2>
                <p><strong>Equipa:</strong> ${stats.team.name}</p>
                <p><strong>Época:</strong> ${stats.league.season}</p>
              </div>
              <div class="stats">
                <div class="stat"><strong>Posição:</strong> ${stats.games.position}</div>
                <div class="stat"><strong>Jogos jogados:</strong> ${stats.games.appearences}</div>
                <div class="stat"><strong>Minutos jogados:</strong> ${stats.games.minutes}</div>
                <div class="stat"><strong>Gols:</strong> ${stats.goals.total}</div>
                <div class="stat"><strong>Assistências:</strong> ${stats.goals.assists ?? 0}</div>
                <div class="stat"><strong>Cartões amarelos:</strong> ${stats.cards.yellow}</div>
                <div class="stat"><strong>Cartões vermelhos:</strong> ${stats.cards.red}</div>
              </div>
            `;

            buscarTopScorers(league, ano);
            found = true;
            break;
          }
        } catch (e) {
          console.error("Erro ao buscar jogador na época", ano);
        }
      }

      if (!found) {
        spinner.style.display = "none";
        resultado.innerHTML = `<p style="color: red; text-align: center; font-weight: bold; margin-top: 20px;">
          ⚠️ Nenhum jogador encontrado com esse nome neste intervalo.</p>`;
      }
    }

    async function buscarTopScorers(league, season) {
      const topScorersDiv = document.getElementById("topScorers");
      topScorersDiv.innerHTML = "<p style='text-align:center;'>Carregando artilheiros...</p>";

      const url = `https://v3.football.api-sports.io/players/topscorers?season=${season}&league=${league}`;

      try {
        const resposta = await fetch(url, {
          headers: { "x-apisports-key": "ce4cbe1f65f7af21897ba33e58fd9372" }
        });

        const data = await resposta.json();

        if (!data.response || data.response.length === 0) {
          topScorersDiv.innerHTML = "<p style='text-align:center;'>Nenhum artilheiro disponível.</p>";
          return;
        }

        const top5 = data.response.slice(0, 5);

        topScorersDiv.innerHTML = top5.map((j, i) => `
          <div style="margin-bottom: 10px; text-align: center;">
            <strong>#${i + 1}</strong> ${j.player.name} (${j.statistics[0].team.name}) - 
            <strong>${j.statistics[0].goals.total}</strong> gols
          </div>
        `).join("");

      } catch (error) {
        topScorersDiv.innerHTML = "<p style='color:red; text-align:center;'>Erro ao carregar top scorers.</p>";
      }
    }
  </script>
</body>
</html>
 
